{"version":3,"sources":["webpack:///webpack/bootstrap d72e7feb0f657635168f","webpack:///external \"mongoose\"","webpack:///external \"koa-router\"","webpack:///external \"path\"","webpack:///./server/model/index.js","webpack:///./server/util/index.js","webpack:///external \"fs\"","webpack:///external \"node-xlsx\"","webpack:///./utils/utils.js","webpack:///./server/index.js","webpack:///external \"koa\"","webpack:///./server/connect/index.js","webpack:///./server/config/envConfig.json","webpack:///external \"koa-body\"","webpack:///./server/interface/index.js","webpack:///./server/interface/user/index.js","webpack:///./server/model/order/model.js","webpack:///./server/model/order/schema.js","webpack:///./server/model/product/model.js","webpack:///./server/model/product/schema.js","webpack:///./server/model/user/model.js","webpack:///./server/model/user/schema.js","webpack:///external \"jsonwebtoken\"","webpack:///./server/util/result.js","webpack:///./server/util/tool.js","webpack:///./server/interface/product/index.js","webpack:///./server/interface/order/index.js","webpack:///external \"moment\"","webpack:///external \"iconv-lite\"","webpack:///./server/interface/stock/index.js","webpack:///external \"nuxt\"","webpack:///./nuxt.config.js","webpack:///external \"bcryptjs\"","webpack:///./server/model/stock/model.js","webpack:///./server/model/stock/schema.js"],"names":["checkExcelType","file","type","name","indexOf","checkCSVType","getType","obj","toString","Object","prototype","map","Element","call","deepClone","data","i","len","length","push","key","replaceAll","str","oldContent","newContent","replace","koaBody","require","path","start","app","Koa","host","process","env","HOST","port","PORT","config","dev","nuxt","Nuxt","builder","Builder","build","use","multipart","encoding","formidable","uploadDir","join","__dirname","keepExtensions","prop","routers","router","routes","allowedMethods","ctx","status","respond","req","render","res","listen","console","log","connect","then","catch","error","url","envConfig","envName","db","testUrl","prodUrl","options","server","poolSize","user","userName","pass","password","useNewUrlParser","useUnifiedTopology","authSource","Promise","resolve","reject","mongoose","err","product","order","stock","createToken","username","token","jwt","sign","id","expiresIn","checkToken","next","request","body","ErrorResult","code","msg","verify","KoaRouter","prefix","post","UsersModel","find","isPasswordValid","bcrypt","compareSync","updateOne","doc","SuccessResult","userModel","save","propName","keyValue","OrdersModel","model","OrdersSchema","Schema","String","required","unique","Number","Array","index","createDate","ProductsModel","ProductSchema","UsersSchema","set","val","hashSync","resultCodeMap","Result","constructor","resultCode","resultResc","resultData","Queue","queue","maxLength","isArray","add","elem","shift","removeByIndex","splice","removeByElem","clear","isInQueue","productAttrNames","delDir","callback","files","fs","existsSync","readdirSync","forEach","curPath","statSync","isDirectory","unlinkSync","fileDataConvert","products","productAttrs","slice","item","attr","idx","currentFile","flag","excelData","xlsx2json","parse","dataList","concat","create","pageSize","pageNum","productName","productCode","productNameReg","RegExp","productCodeReg","documentCount","count","$and","$regex","parseInt","productModel","skip","limit","exec","total","params","JSON","$where","tbAttrNames","dyAttrNames","validateFile","clearQueue","fileName","orders","orderAttrs","platform","moment","Date","format","orderNo","price","valid","buffer","readFileSync","charset","fileData","iconv_lite","decode","split","e","relativeOrder","orderNoReg","titleReg","title","orderModel","sort","get","module","exports","head","meta","content","hid","link","rel","href","css","plugins","loading","color","extend","Client","rules","enforce","test","loader","exclude","StocksModel","StockSchema"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 8);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap d72e7feb0f657635168f","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 0\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 2\n// module chunks = 0","import {\n  OrdersModel\n} from './order/model'\n\nimport {\n  ProductsModel\n} from './product/model'\n\nimport {\n  UsersModel\n} from './user/model'\nimport {\n  StocksModel\n} from './stock/model'\n\nexport {\n  OrdersModel,\n  ProductsModel,\n  UsersModel,\n  StocksModel,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/index.js","import {\n  Result,\n  SuccessResult,\n  ErrorResult,\n} from './result'\nimport {\n  Queue,\n} from './tool'\n\nexport {\n  Result,\n  SuccessResult,\n  ErrorResult,\n  Queue,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/util/index.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"node-xlsx\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"node-xlsx\"\n// module id = 6\n// module chunks = 0","const checkExcelType = (file) =>{\n  let type = file.type;\n  let name = file.name;\n  if(type.indexOf(\"xlsx\") > -1 ||\n    type.indexOf(\"xls\") > -1 ||\n    type.indexOf(\"xltx\") > -1 ||\n    type.indexOf(\"xlt\") > -1 ||\n    type.indexOf(\"xlsm\") > -1 ||\n    type.indexOf(\"xlsb\") > -1 ||\n    type.indexOf(\"xltm\") > -1 ||\n    name.indexOf(\"xlsx\") > -1 ||\n    name.indexOf(\"xls\") > -1 ||\n    name.indexOf(\"xltx\") > -1 ||\n    name.indexOf(\"xlt\") > -1 ||\n    name.indexOf(\"xlsm\") > -1 ||\n    name.indexOf(\"xlsb\") > -1 ||\n    name.indexOf(\"xltm\") > -1\n  ){\n    return true\n  }else{\n    return false;\n  }\n};\n\nconst checkCSVType = (file) =>{\n  let type = file.type;\n  let name = file.name;\n  if(type.indexOf(\"csv\") > -1 || name.indexOf(\"csv\") > -1){\n    return true\n  }else{\n    return false;\n  }\n};\n\nfunction getType(obj){\n  //tostring会返回对应不同的标签的构造函数\n  let toString = Object.prototype.toString;\n  let map = {\n    '[object Boolean]'  : 'boolean',\n    '[object Number]'   : 'number',\n    '[object String]'   : 'string',\n    '[object Function]' : 'function',\n    '[object Array]'    : 'array',\n    '[object Date]'     : 'date',\n    '[object RegExp]'   : 'regExp',\n    '[object Undefined]': 'undefined',\n    '[object Null]'     : 'null',\n    '[object Object]'   : 'object'\n  };\n  if(obj instanceof Element) {\n    return 'element';\n  }\n  return map[toString.call(obj)];\n}\n\nfunction deepClone(data){\n  let type = getType(data);\n  let obj;\n  if(type === 'array'){\n    obj = [];\n  } else if(type === 'object'){\n    obj = {};\n  } else {\n    //不再具有下一层次\n    return data;\n  }\n  if(type === 'array'){\n    for(let i = 0, len = data.length; i < len; i++){\n      obj.push(deepClone(data[i]));\n    }\n  } else if(type === 'object'){\n    for(let key in data){\n      obj[key] = deepClone(data[key]);\n    }\n  }\n  return obj;\n}\n\n\nconst replaceAll = function(str, oldContent, newContent){\n  if(typeof str != 'string'){\n    return str\n  }\n  while(str.indexOf(oldContent) > -1){\n    str = str.replace(oldContent, newContent)\n  }\n  return str\n}\n\n\nexport {\n  checkExcelType,\n  checkCSVType,\n  getType,\n  deepClone,\n  replaceAll,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./utils/utils.js","import Koa from 'koa'\nimport connect from './connect'\nconst koaBody = require('koa-body')\nconst path = require('path')\nimport routers from './interface'\nimport { Nuxt, Builder } from 'nuxt'\n\nasync function start () {\n  const app = new Koa()\n  const host = process.env.HOST || '127.0.0.1'\n  const port = process.env.PORT || 3000\n\n  // Import and Set Nuxt.js options\n  const config = require('../nuxt.config.js')\n  config.dev = !(app.env === 'production')\n\n  // Instantiate nuxt.js\n  const nuxt = new Nuxt(config)\n\n  // Build in development\n  if (config.dev) {\n    const builder = new Builder(nuxt)\n    await builder.build()\n  }\n\n  // body parser 中间件\n  app.use(koaBody({\n    // 支持文件格式\n    multipart: true,\n    encoding:'utf-8',\n    formidable: {\n      // 上传目录\n      uploadDir:path.join(__dirname,'upload'),\n      // 保留文件扩展名\n      keepExtensions: true,\n    }\n  }));\n\n\n  /* 将所有接口引入 */\n  for (let prop in routers){\n    let router = routers[prop]\n    app.use(router.routes())\n    app.use(router.allowedMethods())\n  }\n  app.use(ctx => {\n    ctx.status = 200\n    ctx.respond = false // Mark request as handled for Koa\n    ctx.req.ctx = ctx // This might be useful later on, e.g. in nuxtServerInit or with nuxt-stash\n    nuxt.render(ctx.req, ctx.res)\n  })\n\n  app.listen(port, host)\n  console.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n}\n\nconnect()\n  .then((res) => {\n    console.log(res)\n    start()\n  })\n  .catch((error) => {\n    console.log(error)\n  })\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 9\n// module chunks = 0","import mongoose from \"mongoose\";\nimport envConfig from '../config/envConfig'\n\nlet url = envConfig.envName == 'test' ? envConfig.db.testUrl : envConfig.db.prodUrl\nlet options = {\n  server: {\n    poolSize: envConfig.db.poolSize\n  },\n  user: envConfig.db.userName,\n  pass: envConfig.db.password,\n  useNewUrlParser: true,\n  useUnifiedTopology: true,\n  authSource: 'admin',  // 用户验证到admin数据库去验证\n}\n\nexport default function() {\n  return new Promise(function (resolve, reject) {\n    mongoose.connect(url, options)\n      .then(() => resolve('已成功链接数据库'))\n      .catch((err) => reject(err));\n  })\n}\n\n\n\n\n// WEBPACK FOOTER //\n// ./server/connect/index.js","module.exports = {\"envName\":\"test\",\"db\":{\"testUrl\":\"mongodb://localhost:27017/shop\",\"userName\":\"samuel2306\",\"password\":\"123456\",\"poolSize\":5,\"prodUrl\":\"\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/envConfig.json\n// module id = 11\n// module chunks = 0","module.exports = require(\"koa-body\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-body\"\n// module id = 12\n// module chunks = 0","import user from './user'\nimport product from './product'\nimport order from './order'\nimport stock from './stock'\n\nexport default {\n  user,\n  product,\n  order,\n  stock,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/interface/index.js","import {\n  UsersModel,\n} from '../../model'\nimport jwt from 'jsonwebtoken'\nimport KoaRouter from 'koa-router'\nimport bcrypt from 'bcryptjs'\nimport {\n  SuccessResult,\n  ErrorResult,\n} from '../../util'\n\n\nfunction createToken(username){\n  const token = jwt.sign(\n    {\n      id: username\n    },\n    'cedric1990',\n    {\n      expiresIn: '86400s'\n    }\n  )\n  return token\n}\n\nconst checkToken = async (ctx, next) => {\n  let token = ctx.request.body.token\n  if (!token) {\n    ctx.body = new ErrorResult({\n      code: '0016',\n      msg: '缺少用户token',\n    });\n    return\n  }\n\n  // 检验 token 是否已过期\n  try {\n\n    await jwt.verify(token, 'cedric1990')\n    await next()\n  } catch (err) {\n    ctx.body = new ErrorResult({\n      code: '0014',\n      msg: 'token无效',\n    });\n  }\n}\n\n\n\n\nlet router = KoaRouter();\n// 设置模块名为接口前缀\nrouter.prefix('/api/v1/user')\nrouter.post('/login', async (ctx)=>{\n  let username = ctx.request.body.username\n  let password = ctx.request.body.password\n  await new Promise(async function(resolve, reject){\n    UsersModel.find({\n      username: username\n    }, (err, res) => {\n      if(err){\n        reject({\n          code: \"0001\",\n          msg: err && err.msg ? err.msg : \"未知错误\"\n        })\n      } else if(!res.length){\n        reject({\n          code: \"0001\",\n          msg: \"当前用户名不存在\"\n        })\n      }else{\n        const isPasswordValid = bcrypt.compareSync(password, res[0].password)\n        if(!isPasswordValid){\n          reject({\n            code: \"0001\",\n            msg: \"密码不正确\"\n          })\n        }else{\n          resolve()\n        }\n      }\n    })\n  })\n    .then(async (res) => {\n      let token = createToken(username)\n      await new Promise(async function(resolve, reject){\n        //第一个参数为查找，第二个为要修改的字段\n        UsersModel.updateOne({\"username\": username}, {\n          token: token\n        } ,function (err, doc) {\n          if (err) {reject(err)}\n          else {resolve(doc)}\n        })\n      })\n        .then((res) => {\n          ctx.body = new SuccessResult({\n            msg: '登录成功',\n            data: {\n              username: username,\n              token: token\n            }\n          });\n        })\n        .catch((err) => {\n          ctx.body = new ErrorResult({\n            code: '0001',\n            msg: \"服务器错误\"\n          })\n        })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        code: err.code,\n        msg: err.msg,\n      })\n    })\n})\n\n\nrouter.post('/loginOut', async (ctx)=>{\n  let username = ctx.request.body.username\n  await new Promise(async function(resolve, reject){\n    //第一个参数为查找，第二个为要修改的字段\n    UsersModel.updateOne({\"username\": username}, {\n      token: \"\"\n    } ,function (err, doc) {\n      if (err) {reject(err)}\n      else {resolve(doc)}\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '登出成功'\n      });\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        code: '0001',\n        msg: \"服务器错误\"\n      })\n    })\n})\n\n\n\nrouter.post('/register', async (ctx)=>{\n  let username = ctx.request.body.username\n  let password = ctx.request.body.password\n  await new Promise(async function(resolve, reject){\n    let userModel = new UsersModel({\n      username: username,\n      password: password,\n      token: \"\",\n    })\n    userModel.save(function (err, res) {\n      if (err) {\n        reject(err)\n      }\n      else {\n        resolve(res)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '注册成功'\n      });\n    })\n    .catch((err) => {\n      let propName = ''\n      if(err && err.code == 11000){\n        let keyValue = err[\"keyValue\"]\n        for (let prop in keyValue) {\n          propName = prop\n        }\n      }\n      ctx.body = new ErrorResult({\n        code: err && err.code == 11000 ? '0002' : '0001',\n        msg: err && err.code == 11000 ? '已存在相同用户名的账号' : \"注册失败\"\n      })\n    })\n})\n\nrouter.post('/check', checkToken, async (ctx)=>{\n  ctx.body = new SuccessResult({\n    msg: '用户'\n  });\n})\n\nexport {\n  checkToken\n}\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/interface/user/index.js","import mongoose from'mongoose'\nimport {\n  OrdersSchema,\n} from './schema'\n\n\nlet OrdersModel = mongoose.model('order', OrdersSchema);\n\n\nexport {\n  OrdersModel\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/order/model.js","import mongoose from 'mongoose'\nlet Schema = mongoose.Schema;\n\nlet OrdersSchema = new Schema({\n  'orderNo': {\n    type: String,\n    required: true,\n    unique: true\n  },  // \"订单编号\"\n  'title':  String, // \"标题\"\n  'price':  Number, // \"价格\"\n  'orderNum':  Number, // \"购买数量\"\n  'externalSysNum':  String, // \"外部系统编号\"\n  'productAttrs':  String,  // \"商品属性\"\n  'packageInfo':  String, // \"套餐信息\"\n  'remark':  String, // \"备注\"\n  'orderStatus':  String, // \"订单状态\"\n  'productCode':  String, // \"商家编码\"\n  'createDate':  String, // \"创建时间\"\n  'platform':  String, // \"所属平台\"\n  'relativeOrder':  Array, // \"关联订单\"\n});\n\n// 建立索引\nOrdersSchema.index({ createDate: -1});\n\nexport {\n  OrdersSchema,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/order/schema.js","import mongoose from'mongoose'\nimport {\n  ProductSchema,\n} from './schema'\n\nlet ProductsModel = mongoose.model('product', ProductSchema);\n\nexport {\n  ProductsModel\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/product/model.js","import mongoose from 'mongoose'\nlet Schema = mongoose.Schema;\n\nlet ProductSchema = new Schema({\n  'productCode': {\n    type: String,\n    required: true,\n    unique: true\n  },  // \"商品编号\"\n  'productName':  {\n    type: String,\n    required: true,\n    unique: true\n  }, // \"商品名称\"\n  'price':  Number, // \"价格\"\n  'stock':  Number, // \"库存数量\"\n  'warningStock':  Number, // \"预警库存数量\"\n});\n\nexport {\n  ProductSchema,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/product/schema.js","import mongoose from'mongoose'\nimport {\n  UsersSchema,\n} from './schema'\n\nlet UsersModel = mongoose.model('user', UsersSchema);\n\nexport {\n  UsersModel\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/user/model.js","import mongoose from 'mongoose'\nimport bcrypt from 'bcryptjs'\nlet Schema = mongoose.Schema;\n\nconst UsersSchema = new Schema({\n  username: {\n    type: String,\n    unique: true,\n    required: true\n  },\n  password: {\n    type: String,\n    required: true,\n    set(val){\n      return bcrypt.hashSync(val)\n    }\n  },\n  token: {\n    type: String\n  }\n})\n\n\nexport {\n  UsersSchema,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/user/schema.js","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 21\n// module chunks = 0","let resultCodeMap = {\n  'WL-0000': \"成功\",\n  'WL-0001': \"未知错误\",\n  'WL-0002': \"数据唯一性错误\",\n  'WL-0006': \"参数缺失\",\n  'WL-0008': \"用户没有权限\",\n  'WL-0010': \"文件重复上传\",\n  'WL-0014': \"token无效 | 用户过期\",\n  'WL-0016': \"用户信息缺失\",\n}\n\nclass Result {\n  constructor({code, msg, data}){\n    this.resultCode = code\n    this.resultResc = msg\n    this.resultData = data || null\n  }\n}\n\n\nclass SuccessResult extends Result{\n  constructor({msg, data}){\n    super({\n      code: 'WL-0000',\n      msg: msg ? msg : '操作成功',\n      data: data\n    })\n  }\n}\n\nclass ErrorResult extends Result{\n  constructor({code, msg}){\n    super({\n      code: code ? 'WL-' + code : \"WL-0001\",  // WL-0001未知错误\n      msg: msg ? msg : '操作失败',\n      data: null\n    })\n  }\n}\n\n\nexport {\n  Result,\n  SuccessResult,\n  ErrorResult,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/util/result.js","class Queue {\n  constructor(length, queue){\n    this.maxLength = length\n    this.queue = queue && Array.isArray(queue) ? queue : []\n  }\n  add(elem){\n    if(this.queue.length < this.maxLength){\n      this.queue.push(elem)\n    }else{\n      this.queue.shift()\n      this.queue.push(elem)\n    }\n  }\n  removeByIndex(index){\n    if(index > this.queue.length - 1) return\n    this.queue.splice(index, 1)\n  }\n  removeByElem(elem){\n    let index = this.queue.indexOf(elem)\n    if(index > -1) this.queue.splice(index, 1)\n  }\n  clear(){\n    this.queue = []\n  }\n  isInQueue(elem){\n    return this.queue.indexOf(elem) > -1\n  }\n}\n\nexport {\n  Queue\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/util/tool.js","import fs from \"fs\";\n\nconst path = require('path')\nimport xlsx2json from \"node-xlsx\";\nimport {\n  ProductsModel,\n} from '../../model'\nimport {\n  checkToken\n} from \"../user\"\n\nimport {\n  SuccessResult,\n  ErrorResult,\n  Queue,\n} from '../../util'\nimport {\n  checkExcelType,\n  replaceAll,\n} from '../../../utils/utils'\n\nProductsModel.queue = new Queue(10)\n\nlet router = require('koa-router')();\n// 设置模块名为接口前缀\nrouter.prefix('/api/v1/product')\n\n\nlet productAttrNames = ['productCode', 'productName', 'price', 'stock', 'warningStock']\n\n\nfunction delDir(path, callback){\n  let files = [];\n  if(fs.existsSync(path)){\n    files = fs.readdirSync(path);\n    files.forEach((file, index) => {\n      let curPath = path + \"/\" + file;\n      if(fs.statSync(curPath).isDirectory()){\n        delDir(curPath); //递归删除文件夹\n      } else {\n        fs.unlinkSync(curPath); //删除文件\n      }\n    });\n    // fs.rmdirSync(path);\n  }\n  callback && callback()\n}\n\n// 格式化商品数据\nfunction fileDataConvert(products, productAttrs){\n  products = products.slice(1).map((item) => {\n    let obj = {}\n    productAttrs.forEach((attr, idx) => {\n      let val = item[idx]\n      if(val){\n        val = replaceAll(val, '=\\\"', \"\")\n        obj[attr] = replaceAll(val, '\\\"', \"\")\n      }else{\n        obj[attr] = val\n      }\n    })\n    return obj\n  })\n  return products\n}\n\n\n// 上传文件\nrouter.post('/upload', checkToken, async ctx => {\n  // koa-body会将文件保存在request的files属性中\n  let files = ctx.request.files\n  if(!files || !files.files ){\n    ctx.body = new ErrorResult({\n      msg: \"请选择相应文件进行上传\",\n      code: '0006'\n    })\n    return\n  }\n\n  // files是接口定义的用来代表上传文件的属性，上传单个文件时files.files是File类型，多个文件files.files是数组\n  let res = Array.isArray(files.files) ? files.files : [files.files]\n  let products = []\n  for(let i = 0; i < res.length; i++){\n    let currentFile = res[i]\n\n    /*文件格式验证*/\n    if(!checkExcelType(currentFile)){\n      return {\n        body: new ErrorResult(\"请上传Excel文件\"),\n        flag: false\n      }\n    }\n    let path = currentFile.path || ''\n    let excelData = xlsx2json.parse(path)\n    let dataList = fileDataConvert(excelData[0].data, productAttrNames)\n    ProductsModel.queue.add(currentFile.name)\n    products = products.concat(dataList)\n  }\n\n\n\n  /*删除换存在服务器的文件*/\n  let uploadDir = path.join(__dirname,'../../upload')\n  delDir(uploadDir)\n  /*删除换存在服务器的文件*/\n\n\n  await new Promise(function(resolve, reject){\n    ProductsModel.create(products, function (err, res) {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(res)\n      }\n    })\n  })\n    .then((res) => {\n      // ctx.body = orders\n      ctx.body = new SuccessResult({\n        msg: \"插入商品数据成功\"\n      })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        msg: err ? err : \"导入数据失败\"\n      })\n\n      ctx.body = new ErrorResult({\n        code: err && err.code == 11000 ? '0002' : '0001',\n        msg: err && err.code == 11000 ? '插入部分商品的商品编号已存在' : \"服务器错误\"\n      })\n    })\n})\n\n// 查询商品数据\nrouter.post('/query', checkToken, async ctx => {\n  let pageSize = ctx.request.body.pageSize\n  let pageNum = ctx.request.body.pageNum\n  let productName = ctx.request.body.productName || '' // 商品名称\n  let productCode = ctx.request.body.productCode || '' // 商品编号\n  let stock = ctx.request.body.stock || '' // 库存\n\n  if(!pageSize){\n    ctx.body = new ErrorResult({\n      code: '0006',\n      msg: \"缺少pageSize参数\"\n    })\n    return\n  }\n  if(!pageNum){\n    ctx.body = new ErrorResult({\n      code: '0006',\n      msg: \"缺少pageNum参数\"\n    })\n    return\n  }\n\n  await new Promise(async function(resolve, reject){\n    let productNameReg = new RegExp(productName, 'i')\n    let productCodeReg = new RegExp(productCode, 'i')\n\n\n    let documentCount\n    await ProductsModel.count({\n      $and : [ //多条件，数组\n        {productName : {$regex : productNameReg}},\n        {productCode : {$regex : productCodeReg}},\n      ].concat(stock ? [{stock: stock}] : [])\n    }, (err, count) => {\n      documentCount = err ? 0 : parseInt(count)\n    })\n\n\n    let productModel = ProductsModel.find(\n      {\n        $and : [ //多条件，数组\n          {productName : {$regex : productNameReg}},\n          {productCode : {$regex : productCodeReg}},\n        ].concat(stock ? [{stock: stock}] : [])\n      }\n    )\n    productModel.skip((pageNum - 1) * pageSize).limit(parseInt(pageSize))\n    productModel.exec(function (err, res) {\n      console.log(err)\n      if (err) {\n        reject(err)\n      } else {\n        let data = {\n          total: documentCount,\n          data: res\n        }\n        resolve(data)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '获取商品数据成功',\n        data: res\n      })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        msg: err ? err : \"获取商品数据失败\"\n      })\n    })\n})\n\n\n\n// 插入商品\nrouter.post('/insert', checkToken, async ctx => {\n  let params = ctx.request.body.params ? JSON.parse(ctx.request.body.params) : {}\n  await new Promise(async function(resolve, reject){\n    let productModel = new ProductsModel(params)\n    productModel.save(function (err, res) {\n      if (err) {\n        reject(err)\n      }\n      else {\n        resolve(res)\n      }\n\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '插入商品成功'\n      })\n    })\n    .catch((err) => {\n      let propName = ''\n      if(err && err.code == 11000){\n        let keyValue = err[\"keyValue\"]\n        for (let prop in keyValue) {\n          propName = prop\n        }\n      }\n      ctx.body = new ErrorResult({\n        code: err && err.code == 11000 ? '0002' : '0001',\n        msg: err && err.code == 11000 ? '已存在相同商品编号的商品' : \"服务器错误\"\n      })\n    })\n})\n\n\n// 编辑商品\nrouter.post('/update', checkToken, async ctx => {\n  let params = ctx.request.body.params ? JSON.parse(ctx.request.body.params) : {}\n  let productCode = params.productCode\n  if(!productCode){\n    ctx.body = new ErrorResult({\n      code: '0006',\n      msg: \"缺少商品编码（productCode）参数\"\n    })\n  }\n  await new Promise(async function(resolve, reject){\n    //第一个参数为查找，第二个为要修改的字段\n    ProductsModel.updateOne({\"productCode\": productCode}, params ,function (err, doc) {\n      if (err) {\n        reject(err)\n      }\n      else {\n        resolve(doc)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '编辑商品成功'\n      })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        code: '0001',\n        msg: \"服务器错误\"\n      })\n    })\n})\n\n\n\n// 商品库存检查，是否有商品在预警库存以下\nrouter.post('/stockCheck', checkToken, async ctx => {\n  await new Promise(async function(resolve, reject){\n    let productModel = ProductsModel.find({})\n    productModel.$where('this.stock < this.warningStock')\n    productModel.exec(function (err, res) {\n      console.log(err)\n      if (err) {\n        reject(err)\n      }\n      else {\n        let data = {\n          total: res.length,\n          data: res\n        }\n        resolve(data)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '获取库存预警数据成功',\n        data: res\n      })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        code: '0001',\n        msg: \"服务器错误\"\n      })\n    })\n})\n\n\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/interface/product/index.js","import {\n  checkExcelType,\n  checkCSVType,\n  replaceAll,\n} from '../../../utils/utils'\nimport fs from 'fs'\nimport moment from 'moment'\nconst path = require('path')\nimport xlsx2json from \"node-xlsx\";\nimport iconv_lite from'iconv-lite';\nimport {\n  OrdersModel,\n} from '../../model'\nimport {\n  SuccessResult,\n  ErrorResult,\n  Queue,\n} from '../../util'\nimport {\n  checkToken\n} from \"../user\"\n\nOrdersModel.queue = new Queue(10)\nlet tbAttrNames = [\n  'orderNo',  // \"订单编号\"\n  'title', // \"标题\"\n  'price', // \"价格\"\n  'orderNum', // \"购买数量\"\n  'externalSysNum', // \"外部系统编号\"\n  'productAttrs',  // \"商品属性\"\n  'packageInfo', // \"套餐信息\"\n  'remark', // \"备注\"\n  'orderStatus', // \"订单状态\"\n  'productCode', // \"商家编码\"\n  'createDate', // \"创建时间\"\n]\nlet dyAttrNames = [\n  'orderNo',  // \"订单编号\"\n  'title', // \"标题\"\n  'price', // \"价格\"\n  'orderNum', // \"购买数量\"\n  'externalSysNum', // \"外部系统编号\"\n  'productAttrs',  // \"商品属性\"\n  'packageInfo', // \"套餐信息\"\n  'remark', // \"备注\"\n  'orderStatus', // \"订单状态\"\n  'productCode', // \"商家编码\"\n  'createDate', // \"创建时间\"\n]\n\n\nfunction delDir(path, callback){\n  let files = [];\n  if(fs.existsSync(path)){\n    files = fs.readdirSync(path);\n    files.forEach((file, index) => {\n      let curPath = path + \"/\" + file;\n      if(fs.statSync(curPath).isDirectory()){\n        delDir(curPath); //递归删除文件夹\n      } else {\n        fs.unlinkSync(curPath); //删除文件\n      }\n    });\n    // fs.rmdirSync(path);\n  }\n  callback && callback()\n}\n\nfunction validateFile(currentFile, clearQueue){\n  if(clearQueue == 1) {   // 1表示清除所有文件名的缓存\n    OrdersModel.queue.clear()\n  }\n  let fileName = currentFile.name\n  /*根据文件名称避免重复上传*/\n  if(OrdersModel.queue.isInQueue(fileName)){\n    return {\n      body: new ErrorResult(\"该文件已上传，请勿重复上传\"),\n      flag: false\n    }\n  }\n  /*根据文件名称避免重复上传*/\n\n  /*文件格式验证*/\n  if(!checkExcelType(currentFile) && !checkCSVType(currentFile)){\n    return {\n      body: new ErrorResult(\"请上传正确格式的表格\"),\n      flag: false\n    }\n  }\n\n  return {\n    flag: true\n  }\n}\n\n// 格式化订单数据\nfunction fileDataConvert(orders, orderAttrs, platform, createDate){\n  orders = orders.slice(1).map((item) => {\n    let obj = {\n      platform: platform\n    }\n    orderAttrs.forEach((attr, idx) => {\n      let val = item[idx]\n      if(attr != 'createDate'){\n        if(val){\n          val = replaceAll(val, '=\\\"', \"\")\n          obj[attr] = replaceAll(val, '\\\"', \"\")\n        }else{\n          obj[attr] = val\n        }\n        /*if(attr == 'orderNo'){\n          obj[attr] = String(Number(val))\n        }*/\n      }else {\n        if(!val || val == 'null'){\n          obj[attr] = createDate ? moment(new Date(createDate)).format('YYYY-MM-DD HH:mm:ss') : moment(new Date()).format('YYYY-MM-DD HH:mm:ss')\n        }else{\n          obj[attr] = moment(new Date(val)).format('YYYY-MM-DD HH:mm:ss')\n        }\n      }\n    })\n    return obj\n  })\n  for (let i = orders.length - 1; i >= 0; i--) {\n    if(!orders[i].orderNo && !orders[i].price){\n      orders.splice(i, 1)\n    }\n  }\n  return orders\n}\n\n\n\nlet router = require('koa-router')();\n// 设置模块名为接口前缀\nrouter.prefix('/api/v1/order')\n\n// 上传文件\nrouter.post('/upload', checkToken, async ctx => {\n  // koa-body会将文件保存在request的files属性中\n  let files = ctx.request.files\n  let platform = ctx.request.body.platform   // 'tb': 淘宝，'dy'：抖音\n  let orderAttrs = platform == 'tb' ? tbAttrNames : dyAttrNames\n  let createDate = ctx.request.body.createDate\n  let clearQueue = ctx.request.body.clearQueue || false\n\n  // console.log(files)\n\n  if(!files || !files.files ){\n    ctx.body = new ErrorResult({\n      msg: \"请选择相应文件进行上传\",\n      code: '0006'\n    })\n    return\n  }\n\n  // files是接口定义的用来代表上传文件的属性，上传单个文件时files.files是File类型，多个文件files.files是数组\n  let res = Array.isArray(files.files) ? files.files : [files.files]\n  let orders = []\n  for(let i = 0; i < res.length; i++){\n    let currentFile = res[i]\n\n    let valid = validateFile(currentFile, clearQueue)\n    if(!valid.flag){\n      ctx.body = valid.body\n      return\n    }\n\n    let path = currentFile.path || ''\n    if(checkExcelType(res[i])){\n      let excelData = xlsx2json.parse(path)\n      let dataList = fileDataConvert(excelData[0].data, orderAttrs, platform, createDate)\n      OrdersModel.queue.add(currentFile.name)\n      orders = orders.concat(dataList)\n    }else if(checkCSVType(res[i])){\n      let buffer = fs.readFileSync(path)\n      let charset = ''\n      if((buffer[0] == 0xff && buffer[1] == 0xfe) || (buffer[0] == 0xfe && buffer[1] == 0xff)){\n        charset = 'unicode'\n      }else if(buffer[0] == 0xef && buffer[1] == 0xbb){\n        charset = 'utf8'\n      }else{\n        charset = 'gbk'\n      }\n      try {\n        let fileData = fs.readFileSync(path)\n        let res = iconv_lite.decode(fileData, charset)\n        res = res.split(\"\\n\")\n        res.forEach((item,index) => {\n          res[index] = item.split(',')\n        })\n        let dataList = fileDataConvert(res, orderAttrs, platform, createDate)\n        OrdersModel.queue.add(currentFile.name)\n        orders = orders.concat(dataList)\n      } catch (e) {\n        console.log(e)\n      }\n    }\n  }\n\n\n\n  /*删除换存在服务器的文件*/\n  let uploadDir = path.join(__dirname,'../../upload')\n  delDir(uploadDir)\n  /*删除换存在服务器的文件*/\n\n  // 淘宝数据存在多条数据属于一个订单的情况\n  let obj = {}\n  let idx = []\n  orders.forEach((order, index) => {\n    if(!obj[order.orderNo]){\n      obj[order.orderNo] = order\n      order.relativeOrder = []\n    }else{\n      obj[order.orderNo].relativeOrder.push(order)\n      idx.push(index)\n    }\n  })\n  for (let i = idx.length - 1; i >= 0; i--) {\n    orders.splice(idx[i], 1)\n  }\n\n  await new Promise(function(resolve, reject){\n    OrdersModel.create(orders, function (err, res) {\n      if (err) {\n        reject(err)\n      } else {\n        resolve(res)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: \"插入数据成功\"\n      })\n    })\n    .catch((err) => {\n      let propName = ''\n      if(err && err.code == 11000){\n        let keyValue = err[\"keyValue\"]\n        for (let prop in keyValue) {\n          propName = prop\n        }\n      }\n      ctx.body = new ErrorResult({\n        code: err && err.code == 11000 ? '0002' : '0001',\n        msg: err && err.code == 11000 ? '导入的部分订单的订单编号已存在' : '服务器错误'\n      })\n    })\n})\n\n// 查询订单\nrouter.post('/query', checkToken, async ctx => {\n  let pageSize = ctx.request.body.pageSize\n  let pageNum = ctx.request.body.pageNum\n  let orderNo = ctx.request.body.orderNo || ''  // 订单编号\n  let productName = ctx.request.body.productName || '' // 商品名称， 对应文档的title标题\n  let productCode = ctx.request.body.productCode || '' // 商品编号\n\n  if(!pageSize){\n    ctx.body = new ErrorResult({\n      code: '0006',\n      msg: \"缺少pageSize参数\"\n    })\n    return\n  }\n  if(!pageNum){\n    ctx.body = new ErrorResult({\n      code: '0006',\n      msg: \"缺少pageNum参数\"\n    })\n    return\n  }\n\n  await new Promise(async function(resolve, reject){\n    let orderNoReg = new RegExp(orderNo, 'i')\n    let titleReg = new RegExp(productName, 'i')\n    let productCodeReg = new RegExp(productCode, 'i')\n\n\n    let documentCount\n    await OrdersModel.count({\n      $and : [ //多条件，数组\n        {orderNo : {$regex : orderNoReg}},\n        {title : {$regex : titleReg}},\n        {productCode : {$regex : productCodeReg}},\n      ]\n    }, (err, count) => {\n      documentCount = err ? 0 : parseInt(count)\n    })\n\n\n    let orderModel = OrdersModel.find(\n      {\n        $and : [ //多条件，数组\n          {orderNo : {$regex : orderNoReg}},\n          {title : {$regex : titleReg}},\n          {productCode : {$regex : productCodeReg}},\n        ]\n      }\n    )\n    orderModel.sort({\"createDate\" : -1}).skip((pageNum - 1) * pageSize).limit(parseInt(pageSize))\n    orderModel.exec(function (err, res) {\n      console.log(err)\n      if (err) {\n        reject(err)\n      } else {\n        let data = {\n          total: documentCount,\n          data: res\n        }\n        resolve(data)\n      }\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '获取数据成功',\n        data: res\n      })\n    })\n    .catch((err) => {\n      ctx.body = new ErrorResult({\n        msg: err ? err : \"获取数据失败\"\n      })\n    })\n})\n\n\n// 插入订单\nrouter.post('/insert', checkToken, async ctx => {\n  let params = ctx.request.body.params ? JSON.parse(ctx.request.body.params) : {}\n  await new Promise(async function(resolve, reject){\n    let orderModel = new OrdersModel(params)\n    orderModel.save(function (err, res) {\n      if (err) {\n        reject(err)\n      }\n      else {\n        resolve(res)\n      }\n\n    })\n  })\n    .then((res) => {\n      ctx.body = new SuccessResult({\n        msg: '插入数据成功'\n      })\n    })\n    .catch((err) => {\n      let propName = ''\n      if(err && err.code == 11000){\n        let keyValue = err[\"keyValue\"]\n        for (let prop in keyValue) {\n          propName = prop\n        }\n      }\n      ctx.body = new ErrorResult({\n        code: err && err.code == 11000 ? '0002' : '0001',\n        msg: err && err.code == 11000 ? '已存在相同订单编号的订单' : \"服务器错误\"\n      })\n    })\n})\n\n\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/interface/order/index.js","module.exports = require(\"moment\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"moment\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"iconv-lite\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"iconv-lite\"\n// module id = 28\n// module chunks = 0","import {\n  StocksModel\n}  from '../../model'\n\nlet router = require('koa-router')();\n// 设置模块名为接口前缀\nrouter.prefix('/api/v1/stock')\nrouter.get('/aaa',async (ctx)=>{\n  ctx.body=\"首页\";\n})\n\nexport default router\n\n\n\n// WEBPACK FOOTER //\n// ./server/interface/stock/index.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 30\n// module chunks = 0","module.exports = {\n  /*\n  ** Headers of the page\n  */\n  head: {\n    title: 'starter',\n    meta: [\n      { charset: 'utf-8' },\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\n    ],\n    link: [\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\n    ]\n  },\n  /*\n  ** Global CSS\n  */\n  css: ['~assets/css/main.css','element-ui/lib/theme-chalk/index.css'],\n  plugins: [\n    \"@/plugins/element-ui\",\n    \"@/plugins/globalComponents\",\n  ],\n  /*\n  ** Customize the progress-bar color\n  */\n  loading: { color: '#3B8070' },\n  /*\n   ** Build configuration\n   */\n  build: {\n    /*\n     ** Run ESLINT on save\n     */\n    extend (config, ctx) {\n      if (ctx.Client) {\n        config.module.rules.push({\n          enforce: 'pre',\n          test: /\\.(js|vue)$/,\n          loader: 'eslint-loader',\n          exclude: /(node_modules)/\n        })\n      }\n    }\n  }\n}\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js","module.exports = require(\"bcryptjs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcryptjs\"\n// module id = 32\n// module chunks = 0","import mongoose from'mongoose'\nimport {\n  StockSchema,\n} from './schema'\n\nlet StocksModel = mongoose.model('stock', StockSchema);\n\nexport {\n  StocksModel\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/stock/model.js","import mongoose from 'mongoose'\nlet Schema = mongoose.Schema;\n\nlet StockSchema = new Schema({\n  'warehouseDocCode': {\n    type: String,\n    required: true,\n    unique: true\n  },  // \"仓库单编号\"\n  'warehouseDocType':  {\n    type: Number,\n    required: true\n  }, // \"仓库单类型： 0 入库单， 1 出库单\"\n  'warehouseDocStatus':  {\n    type: Number,\n    required: true\n  }, // \"仓库单类型： 0 进行中， 1 已完成\"\n  'productList':  Array, // \"商品列表\"\n});\n\nexport {\n  StockSchema,\n}\n\n\n\n// WEBPACK FOOTER //\n// ./server/model/stock/schema.js"],"sourceRoot":""}